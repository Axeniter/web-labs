{% extends 'base.html' %}
{% load static %}

{% block title %}Citrus | {{ article.title }}{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/article_detail.css' %}">
{% endblock %}

{% block main %}
<article class="article-detail">
    <h1 class="article-title">{{ article.title }}</h1>
    <div class="article-meta">
        Автор: {{ article.author.username }} | 
        {{ article.created_date|date:"d.m.Y H:i" }} | 
        Категория: {{ article.get_category_display }}
    </div>
    
    <div class="article-content">
        {{ article.text|linebreaks }}
    </div>

    {% if user == article.author %}
    <div class="article-actions">
        <a href="{% url 'edit_article' article.id %}" class="btn-edit">Редактировать</a>
        <a href="{% url 'delete_article' article.id %}" class="btn-delete">Удалить</a>
    </div>
    {% endif %}
</article>

<hr class="section-divider">

<section class="comments-section">
    <h3 class="comments-title">Комментарии ({{ comments.count }})</h3>
    
    {% if user.is_authenticated %}
    <div class="comment-form-card">
        <h5 class="comment-form-title">Добавить комментарий</h5>
        <form method="post" class="comment-form">
            {% csrf_token %}
            <div class="form-group">
                {{ form.text }}
            </div>
            <button type="submit" class="btn-submit">Отправить</button>
        </form>
    </div>
    {% else %}
    <div class="auth-alert">
        <a href="{% url 'login' %}">Войдите</a>, чтобы оставить комментарий.
    </div>
    {% endif %}

    <div class="comments-list">
        {% for comment in comments %}
        <div class="comment-card">
            <div class="comment-header">
                <strong class="comment-author">{{ comment.author.username }}</strong>
                <span class="comment-date">{{ comment.created_date|date:"d.m.Y H:i" }}</span>
            </div>
            <div class="comment-text">{{ comment.text|linebreaks }}</div>
        </div>
        {% empty %}
        {% if user.is_authenticated %}
        <div class="no-comments">
            Пока нет комментариев. Напиши "я первый"!
        </div>
        {% endif %}
        {% endfor %}
    </div>
</section>
{% endblock %}